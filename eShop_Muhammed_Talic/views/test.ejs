<!DOCTYPE html>
<html lang="bs">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>test</title>

  </head>
  <body>
    <h1> </h1>
    Chat App
    <div id="messages">

    </div>

    <form id="message-form">
      <input name="message" placeholder="Message">
      <button>Send</button>
    </form>
    <button id="send-location">Send location</button>

    <script id="message-template" type="text/html">
      <div>
        <p> {{createAt}} - {{mess}} </p>
      </div>
    </script>
    <script id="location-message-template" type="text/html">
      <div>
        <p><a href="{{url}}" target="_blank">Trenutna adresa</a></p>
      </div>
    </script>


  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.0.1/mustache.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.6.0/qs.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const $messages = document.querySelector('#messages')
    // Templates
    const messageTemplate = document.querySelector('#message-template').innerHTML

    socket.on('poruka', (mess) => {
      console.log(mess)
      const html = Mustache.render(messageTemplate, {
        mess: mess.text,
        createAt: moment(mess.createdAt).format('h:mm a')
      })
      $messages.insertAdjacentHTML('beforeend', html)
    })


    document.querySelector('#message-form').addEventListener('submit', (e) => {
      e.preventDefault()
      const message = e.target.elements.message.value
      socket.emit('posaljiPoruku', message)
    })


    const locationMessageTemplate = document.querySelector('#location-message-template').innerHTML
    socket.on('locationMessage', (url) => {
      console.log(url)
      const html = Mustache.render(locationMessageTemplate, {
        url
      })
      $messages.insertAdjacentHTML('beforeend', html)
    })

    const $sendLocationButton = document.querySelector('#send-location')
    $sendLocationButton.addEventListener('click', () => {
      if (!navigator.geolocation) {
        return alert('Geolocation is not supported by your browser.')
      }

      // $sendLocationButton.setAttribute('disabled', 'disabled')

      navigator.geolocation.getCurrentPosition((position) => {
        socket.emit('sendLocation', {
          latitude: position.coords.latitude,
          longitude: position.coords.longitude
        }, )
      })
    })


  </script>
</html>


<!--
// tut 5.ejs
<button id="increment"> +1 </button>

    socket.on('countUpdated', (count) => {
      console.log('The count has been updated!', count)
    })

    document.querySelector('#increment').addEventListener('click', () => {
      console.log('Clicked')
      socket.emit('increment')
    })

-->

<!--
// tut 6.ejs
<form id="message-form">
      <input name="message" placeholder="Message">
      <button>Send</button>
    </form>

socket.on('poruka', (mess) =>{
      console.log(mess)
    })


    document.querySelector('#message-form').addEventListener('submit', (e) => {
      e.preventDefault()

      const message = e.target.elements.message.value

      socket.emit('posaljiPoruku', message)
    })
-->

<!-- 7.tut navigator
document.querySelector('#send-location').addEventListener('click', () => {
    if (!navigator.geolocation) {
        return alert('Geolocation is not supported by your browser.')
    }

    navigator.geolocation.getCurrentPosition((position) => {
        socket.emit('sendLocation', {
            latitude: position.coords.latitude,
            longitude: position.coords.longitude
        })
    })
})
-->